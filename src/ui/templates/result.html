<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Results - Cookify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 60px;
            background-color: #f8f9fa;
        }
        .recipe-container {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.3rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 2rem;
        }
        .recipe-header {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
        }
        .recipe-meta {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .ingredient-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .step-item {
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: #28a745;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
        }
        .tool-badge {
            background-color: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }
        .action-buttons {
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">Cookify</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="action-buttons">
            <a href="/" class="btn btn-outline-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Back to Home
            </a>
            <a href="/results/download/{{ unique_id }}" class="btn btn-outline-success ms-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                </svg>
                Download Recipe (JSON)
            </a>
        </div>

        {% if video_path %}
        <div class="video-container">
            <video controls>
                <source src="{{ video_path }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        {% endif %}

        <div class="recipe-container">
            <div class="recipe-header">
                <h1>{{ result.title or "Untitled Recipe" }}</h1>
                <div class="recipe-meta">
                    {% if result.servings %}
                    <span class="me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
                            <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/>
                        </svg>
                        Servings: {{ result.servings }}
                    </span>
                    {% endif %}
                    {% if result.total_time %}
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        Total Time: {{ result.total_time }}
                    </span>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h4 class="mb-0">Ingredients</h4>
                        </div>
                        <div class="card-body">
                            {% if result.ingredients and result.ingredients|length > 0 %}
                            <ul class="list-unstyled">
                                {% for ingredient in result.ingredients %}
                                <li class="ingredient-item">
                                    {% if ingredient.qty and ingredient.unit %}
                                    <strong>{{ ingredient.qty }} {{ ingredient.unit }}</strong> {{ ingredient.name }}
                                    {% elif ingredient.qty %}
                                    <strong>{{ ingredient.qty }}</strong> {{ ingredient.name }}
                                    {% else %}
                                    {{ ingredient.name }}
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="text-muted">No ingredients detected</p>
                            {% endif %}
                        </div>
                    </div>

                    {% if result.tools and result.tools|length > 0 %}
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h4 class="mb-0">Tools</h4>
                        </div>
                        <div class="card-body">
                            <div>
                                {% for tool in result.tools %}
                                <span class="badge tool-badge">{{ tool }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h4 class="mb-0">Instructions</h4>
                        </div>
                        <div class="card-body">
                            {% if result.steps and result.steps|length > 0 %}
                            <ol class="list-unstyled">
                                {% for step in result.steps %}
                                <li class="step-item">
                                    <div>
                                        <span class="step-number">{{ step.idx }}</span>
                                        <span>
                                            {% if step.action %}{{ step.action|title }}{% endif %}
                                            {% if step.objects %}: {{ step.objects|join(', ') }}{% endif %}
                                            {% if step.details %}. {{ step.details }}{% endif %}
                                        </span>
                                    </div>
                                    {% if step.start is defined and video_path %}
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-outline-primary jump-to-video" data-time="{{ step.start }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
                                                <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
                                            </svg>
                                            Watch this step
                                        </button>
                                    </div>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ol>
                            {% else %}
                            <p class="text-muted">No steps detected</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer text-center">
        <div class="container">
            <p>© 2025 Cookify - Extract Recipes from Cooking Videos</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get video element
            const video = document.querySelector('video');
            
            // Add event listeners to jump-to-video buttons
            const jumpButtons = document.querySelectorAll('.jump-to-video');
            jumpButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const time = parseFloat(this.getAttribute('data-time'));
                    if (video && !isNaN(time)) {
                        video.currentTime = time;
                        video.play();
                        // Scroll to video
                        video.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>
